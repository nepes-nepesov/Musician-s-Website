doctype html
//
  Problem:
  The HTMLMediaElement passed to createMediaElementSource has a cross-origin resource, the node will output silence.  audio-oscilloscope.js:9:13
  Solution:
  Media servers should serve the audio files with a CORS "Access-Control-Allow-Origin: *" HTTP response header
html
  head
    meta(charset='utf-8')
    title Audio
    link(rel='stylesheet', type="text/css", href='stylesheets/common.css')
    script(src='https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js')
    // Used by Stripe in payment.js
    script(type='text/javascript', src='https://js.stripe.com/v2/')
    script(type='text/javascript').
      Stripe.setPublishableKey('pk_test_rc9YXvtg5HuFinuDJukp1HeR');
      $(function() {
      var $form = $('#payment-form');
      $form.submit(function(event) {
      // Disable the submit button to prevent repeated clicks:
      $form.find('.submit').prop('disabled', true);
      // Request a token from Stripe:
      Stripe.card.createToken($form, stripeResponseHandler);
      // Prevent the form from being submitted:
      return false;
      });
      });
      
      function stripeResponseHandler(status, response) {
      // Grab the form:
      var $form = $('#payment-form');
      if (response.error) { // Problem!
      // Show the errors on the form:
      $form.find('.payment-errors').text(response.error.message);
      $form.find('.submit').prop('disabled', false); // Re-enable submission
      } else { // Token was created!
      // Get the token ID:
      var token = response.id;
      console.log(token);
      // Insert the token ID into the form so it gets submitted to the server:
      //$form.append($('<input type="hidden" name="stripeToken">').val(token));
      $form.append("<input type='hidden' name='stripeToken' value='" + response.id + "'/>");
      // Submit the form:
      $form.get(0).submit();
      }
      };
  body
    form#payment-form(action='/after-charge', method='POST')
      span.payment-errors
      .form-row
        label
          span Card Number
          input(type='text', size='20', data-stripe='number', value='4242424242424242')
      .form-row
        label
          span Expiration (MM/YY)
          input(type='text', size='2', data-stripe='exp_month', value='12')
        span  / 
        input(type='text', size='2', data-stripe='exp_year', value='18')
      .form-row
        label
          span CVC
          input(type='text', size='4', data-stripe='cvc', value='123')
      input.submit(type='submit', value='Submit Payment')